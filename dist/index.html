<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv="X-UA-Compatible" content="ie=edge"><script src="http://by-health-cdn.oss-cn-beijing.aliyuncs.com/region/regions.js"></script><title>AddressPicker</title><style>#example{line-height:40px;background-color:#149f40;width:260px;margin:30px auto 10px auto;color:#fff;border-radius:.2em;text-align:center}#exampleshow{line-height:40px;background-color:#9f53a5;width:260px;margin:30px auto 10px auto;color:#fff;border-radius:.2em;text-align:center}#exampleMobile{line-height:40px;background-color:#14969f;width:260px;margin:30px auto 10px auto;color:#fff;border-radius:.2em;text-align:center}#exampleUpdateMobile{line-height:40px;background-color:#646464;width:260px;margin:30px auto 10px auto;color:#fff;border-radius:.2em;text-align:center}#uitest{display:none}</style></head><body><div id="example">click me show AddressPicker</div><div id="exampleshow">河北 (['19', '1922', '192215'])</div><div id="exampleMobile">mobile-select</div><div id="exampleUpdateMobile">updateDate mobile-select</div><br><div style="text-align:center"><a href="https://github.com/eightfeet/AddressPicker/blob/master/README.md">Documents</a></div><ul id="uitest"><li id="onConfirm"></li><li id="onCancel"></li><li id="transitionEnd"></li><li id="onShow"></li><li id="onHide"></li></ul><script type="text/javascript" src="./picker.js?d63882ec99486c3c44d4"></script></body><script>function formatWheelsData(data){
            var provinces = [];
            var cities = [];
            var counties = [];
            
            for (var key in data) {
                if (data.hasOwnProperty(key)) {
                    var items = data[key];
                    for (var el in items) {
                        if (items.hasOwnProperty(el)) {
                            var element = items[el];
                            if (el.length === 2) {
                                provinces.push({
                                    id: el,
                                    value: element,
                                    childs: []
                                });
                            }
                            if (el.length === 4) {
                                cities.push({
                                    id: el,
                                    value: element,
                                    childs: []
                                });
                            }
                            if (el.length === 6) {
                                counties.push({
                                    id: el,
                                    value: element
                                });
                            }
                        }
                    }
                }
            }
            
            for (var indexP = 0; indexP < provinces.length; indexP++) {
                var elementP = provinces[indexP];
                var elementPChild = elementP.childs;
                for (var indexCi = 0; indexCi < cities.length; indexCi++) {
                    var elementCi = cities[indexCi];
                    var elementCiChild = elementCi.childs;
                    if (elementP.id === elementCi.id.slice(0, 2)) {
                        elementPChild.push(elementCi);
                        for (var indexC = 0; indexC < counties.length; indexC++) {
                            var elementC = counties[indexC];
                            if (elementCi.id === elementC.id.slice(0, 4)) {
                                elementCiChild.push(elementC);
                            }
                        }
                    }
                }
                
            }

            return provinces;
        }

        function getPositionByDefaultValue(defaultData, wheels){
            var defaultValue = defaultData || [];
            if (!Array.isArray(defaultValue) || defaultValue.length < 1) {
                return;
            }
            var data = wheels[0].data;
            var position = [];
            for (var indexP = 0; indexP < data.length; indexP++) {
                var elementP = data[indexP];
                var elementPChilds = elementP.childs;
                if (defaultValue[0] === elementP.id) {
                    position.push(indexP);
                }
                for (var indexCi = 0; indexCi < elementPChilds.length; indexCi++) {
                    var elementCi = elementPChilds[indexCi];
                    var elementCiChilds = elementCi.childs;
                    if (defaultValue[1] === elementCi.id) {
                        position.push(indexCi);
                    }
                    for (var indexC = 0; indexC < elementCiChilds.length; indexC++) {
                        var elementC = elementCiChilds[indexC];
                        if (defaultValue[2] === elementC.id) {
                            position.push(indexC);
                            break;
                        }
                    }
                }
            }
            return position;
        }

        var regions = formatWheelsData(window.BY_HEALTH_REGIONS);
        var popularCities = [
            {name: '北京', id: ['12', '1210']},
            {name: '上海', id: ['34', '3410']},
            {name: '广州', id: ['15', '1513']},
            {name: '深圳', id: ['15', '1524']},
            {name: '杭州', id: ['43', '4311']},
            {name: '南京', id: ['26', '2613']},
            {name: '天津', id: ['37', '3710']},
            {name: '苏州', id: ['26', '2616']},
            {name: '长沙', id: ['24', '2411']},
            {name: '重庆', id: ['13', '1310']},
            {name: '成都', id: ['32', '3212']}
        ];

        window.newPicker = new ___picker___.AddressPicker({
            // id: '555666',
            trigger: '#example', // 触发Dom
            // title: '请选择省市区', // 设置标题
            // defaultValue: ['15', '1513', '151315'], // 默认选择的地址
            triggerDisplayData: true, // 是否在"触发Dom"中显示已选数据 默认false(mobile-select中默认true)
            regions: regions, // 原始数据
            popularCities: popularCities,
            // callback 确定后的回调，返回两个参数值，indexArr, data (分别代表当前选中wheels的位置和值)。
            // onConfirm: function(indexArr, data){
            //     console.log('callback', indexArr, data);
            // },
            // 取消后的回调
            onCancel: function(indexArr, data){
                console.log('取消', indexArr, data);
            },
            // 控制样式
            style: {
                // 确定按钮
                confirmBtn: {
                    backgroundColor: '#7fb581',
                    color: '#fff',
                    padding: '5px 10px',
                    borderRadius: '5px'
                },
                // 取消按钮
                cancelBtn: {
                    backgroundColor: '#eee',
                    padding: '5px 10px',
                    borderRadius: '5px'
                },
                // 半透明覆盖层
                overlay: {
                },
                // 热门城市
                popularCities: {
                    backgroundColor: '#efefef',
                },
                popularCitiesTitle: {
                },
                popularCitiesItem: {
                }
            }
        });

        function getDaysInOneMonth(year, month){
            month = parseInt(month, 10);
            let d= new Date(year, month, 0);
            return d.getDate();
        }

        function getYearDate(year){
            const data = [];
            const M = {};
            M.data = [];
            for (let yi = 1; yi < 13; yi++) {
                const temp = {date: `${yi}月`, val: yi, childs: []};
                const days = getDaysInOneMonth(year, yi);
                for (let di = 1; di <= days; di++) {
                    const mdays =  {date: `${di}日`, val: di, childs: []};
                    for (let hi = 0; hi < 24; hi++) {
                        const hdata = {date: `${hi}时`, val: hi, childs: []};
                        for (let mi = 0; mi < 12; mi++) {
                            hdata.childs.push({date: `${mi * 5}分`, val: mi * 5});
                        }
                        mdays.childs.push(hdata);
                    }
                    temp.childs.push(mdays);
                }
                M.data.push(temp);
            }
            data.push(M);
            return data;
        }

        var msData = getYearDate(2019);

        // console.log(getYearDate(2019));

        /**
         * id,
         * wheels: [{data:[]}],
         * keyMap,
         * cancelBtnText,
         * ensureBtnText,
         * trigger,
         * onConfirm,
         * onCancel,
         * transitionEnd,
         * onShow,
         * onHide,
         * position
         * title,
         * triggerDisplayData,
         * ensureBtnColor,
         * cancelBtnColor,
         * titleColor,
         * textColor,
         * titleBgColor,
         * bgColor,
         * maskOpacity
         */

        window.newMobileSelect = new ___picker___.MobileSelect({
            id:'mobileId',
            wheels:msData,
            trigger: '#exampleMobile',
            keyMap: {id: 'val', value: 'date', childs: 'childs'},
            cancelBtnText: 'cancel',
            ensureBtnText: 'ensure',
            triggerDisplayData: true,
            onConfirm: function(a, b){
                document.getElementById('onConfirm').innerText='onConfirm'+a[0]+b[0].date;
            },
            onCancel: function(a, b){
                if (a.length === 0) return;
                document.getElementById('onCancel').innerText='onCancel'+a[0]+b[0].date;
            },
            transitionEnd: function(a, b){
                document.getElementById('transitionEnd').innerText='transitionEnd'+a[0]+b[0].date;
            },
            onShow: function(e){
                document.getElementById('onShow').innerText='onShow';
            },
            onHide: function(e){
                document.getElementById('onHide').innerText='onHide';
            },
            position: [3,5,5,5],
            title: '选择日期',
            ensureBtnColor: '#000',
            cancelBtnColor: '#000',
            textColor: 'red',
            titleColor: '#000',
            titleBgColor: '#fff',
            bgColor: '#fff',
            maskOpacity: 0.5
        });

        document.getElementById('exampleshow').onclick = function(){
            // 更新省市区位置 arguments:([省id, 市id, 区id], callback)
            window.newPicker.upDatePicker(['19', '1922', '192215'], function(){
                // 显示AddressPicker
                window.newPicker.showPicker();
            })
        };

        document.getElementById('exampleUpdateMobile').onclick = function(){
            console.log(333, window.newMobileSelect.initPosition);
            // 更新滚动位置
            window.newMobileSelect.show();
        };</script></html>