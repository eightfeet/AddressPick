<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script src="http://by-health-cdn.oss-cn-beijing.aliyuncs.com/region/regions.js"></script>
    <title>AddressPicker</title>
    <style>
        html,body {
            width: 100%;
        }
        #example {
            line-height: 40px; background-color: rgb(20, 159, 64); width:260px; margin: 30px auto 10px auto; color: #fff; border-radius: 0.2em; text-align: center; 
        }
        #exampleshow {
            line-height: 40px; background-color: rgb(159, 83, 165); width:260px; margin: 30px auto 10px auto; color: #fff; border-radius: 0.2em; text-align: center; 
        }
        #exampleMobile {
            line-height: 40px; background-color: rgb(20, 150, 159); width:260px; margin: 30px auto 10px auto; color: #fff; border-radius: 0.2em; text-align: center; 
        }
        #exampleUpdateMobile {
            line-height: 40px; background-color: rgb(100, 100, 100); width:260px; margin: 30px auto 10px auto; color: #fff; border-radius: 0.2em; text-align: center; 
        }
        #uitest {
            display: none;
        }
        .mobileId_activated {
            color: red;
        }
    </style>
</head>
<body>
    <div id="example">click me show AddressPicker</div>
    <div id="exampleshow">河北 (['19', '1922', '192215'])</div>
    <div id="exampleMobile">mobile-select</div>
    <div id="exampleUpdateMobile">mobile-select([7, 9, 2, 20])</div>
    <br />
    <div style="text-align: center"><a href="https://github.com/eightfeet/AddressPicker/blob/master/README.md">Documents</a></div>
    <ul id="uitest">
        <li id="onConfirm"></li>
        <li id="onCancel"></li>
        <li id="transitionEnd"></li>
        <li id="onShow"></li>
        <li id="onHide"></li>
    </ul>
</body>    
    <script>
        function formatWheelsData(data){
            var provinces = [];
            var cities = [];
            var counties = [];
            
            for (var key in data) {
                if (data.hasOwnProperty(key)) {
                    var items = data[key];
                    for (var el in items) {
                        if (items.hasOwnProperty(el)) {
                            var element = items[el];
                            if (el.length === 2) {
                                provinces.push({
                                    id: el,
                                    value: element,
                                    childs: []
                                });
                            }
                            if (el.length === 4) {
                                cities.push({
                                    id: el,
                                    value: element,
                                    childs: []
                                });
                            }
                            if (el.length === 6) {
                                counties.push({
                                    id: el,
                                    value: element
                                });
                            }
                        }
                    }
                }
            }
            
            for (var indexP = 0; indexP < provinces.length; indexP++) {
                var elementP = provinces[indexP];
                var elementPChild = elementP.childs;
                for (var indexCi = 0; indexCi < cities.length; indexCi++) {
                    var elementCi = cities[indexCi];
                    var elementCiChild = elementCi.childs;
                    if (elementP.id === elementCi.id.slice(0, 2)) {
                        elementPChild.push(elementCi);
                        for (var indexC = 0; indexC < counties.length; indexC++) {
                            var elementC = counties[indexC];
                            if (elementCi.id === elementC.id.slice(0, 4)) {
                                elementCiChild.push(elementC);
                            }
                        }
                    }
                }
                
            }

            return provinces;
        }

        var regions = formatWheelsData(window.BY_HEALTH_REGIONS);

        const defaultData = ['15', '1513', '151315'];

        var popularCities = [
            {name: '北京', id: ['12', '1210']},
            {name: '上海', id: ['34', '3410']},
            {name: '广州', id: ['15', '1513']},
            {name: '深圳', id: ['15', '1524']},
            {name: '杭州', id: ['43', '4311']},
            {name: '南京', id: ['26', '2613']},
            {name: '天津', id: ['37', '3710']},
            {name: '苏州', id: ['26', '2616']},
            {name: '长沙', id: ['24', '2411']},
            {name: '重庆', id: ['13', '1310']},
            {name: '成都', id: ['32', '3212']}
        ];

        window.newPicker = new ___picker___.AddressPicker({
            // id: '555666',
            trigger: '#example', // 触发Dom
            // title: '请选择省市区', // 设置标题
            defaultValue: ['15', '1513', '151315'], // 默认选择的地址
            triggerDisplayData: true, // 是否在"触发Dom"中显示已选数据 默认false(mobile-select中默认true)
            regions: regions, // 原始数据
            // keyMap: {id: 'value', value: 'id', childs: 'childs'},
            popularCities: popularCities,
            // callback 确定后的回调，返回两个参数值，indexArr, data (分别代表当前选中wheels的位置和值)。
            onConfirm: function(indexArr, data){
                console.log('callback', indexArr, data);
            },
            // 取消后的回调
            onCancel: function(indexArr, data){
                console.log('取消', indexArr, data);
            },
            // 控制样式
            style: {
                // 确定按钮
                confirmBtn: {
                    backgroundColor: '#7fb581',
                    color: '#fff',
                    padding: '5px 10px',
                    borderRadius: '5px'
                },
                // 取消按钮
                cancelBtn: {
                    backgroundColor: '#eee',
                    padding: '5px 10px',
                    borderRadius: '5px'
                },
                // 半透明覆盖层
                overlay: {
                },
                // 热门城市
                popularCities: {
                    backgroundColor: '#efefef',
                },
                popularCitiesTitle: {
                },
                popularCitiesItem: {
                }
            }
        });

        function getDaysInOneMonth(year, month){
            month = parseInt(month, 10);
            let d= new Date(year, month, 0);
            return d.getDate();
        }

        function getYearDate(year){
            const data = [];
            const M = {};
            M.data = [];
            for (let yi = 1; yi < 13; yi++) {
                const temp = {date: `${yi}月`, val: yi, childs: []};
                const days = getDaysInOneMonth(year, yi);
                for (let di = 1; di <= days; di++) {
                    const mdays =  {date: `${di}日`, val: di, childs: []};
                    for (let hi = 0; hi < 24; hi++) {
                        const hdata = {date: `${hi}时`, val: hi, childs: []};
                        for (let mi = 0; mi < 12; mi++) {
                            hdata.childs.push({date: `${mi * 5}分`, val: (mi * 5)});
                        }
                        mdays.childs.push(hdata);
                    }
                    temp.childs.push(mdays);
                }
                M.data.push(temp);
            }
            data.push(M);
            return data;
        }

        var msData = getYearDate(2019);

        // console.log(getYearDate(2019));

        /**
         * id,
         * wheels: [{data:[]}],
         * keyMap,
         * cancelBtnText,
         * ensureBtnText,
         * trigger,
         * onConfirm,
         * onCancel,
         * transitionEnd,
         * onShow,
         * onHide,
         * position
         * title,
         * triggerDisplayData,
         * ensureBtnColor,
         * cancelBtnColor,
         * titleColor,
         * textColor,
         * titleBgColor,
         * bgColor,
         * maskOpacity
         */

        window.newMobileSelect = new ___picker___.MobileSelect({
            id:'mobileId',
            // wheels:msData,
            wheels: [
                {
                    data:[
                        {id: 0, value: '周日'},
                        {id: 1, value: '周一'},
                        {id: 2, value: '周二'},
                        {id: 3, value: '周三'},
                        {id: 4, value: '周四'},
                        {id: 5, value: '周五'},
                        {id: 6, value: '周六'}
                    ]
                },
                {
                    data:[
                        {id:8, value:'08:00'},
                        {id:9, value:'09:00'},
                        {id:10, value:'10:00'},
                        {id:11, value:'11:00'},
                        {id:12, value:'12:00'},
                        {id:13, value:'13:00'},
                        {id:14, value:'14:00'}
                    ]
                }
            ],
            // wheels: [
            //     {
            //         data:[
            //             '周日',
            //             '周一',
            //             '周二',
            //             '周三',
            //             '周四',
            //             '周五',
            //             '周六'
            //         ]
            //     },
            //     {
            //         data:[
            //             '08:00',
            //             '09:00',
            //             '10:00',
            //             '11:00',
            //             '12:00',
            //             '13:00',
            //             '14:00'
            //         ]
            //     }
            // ],
            trigger: '#exampleMobile',
            keyMap: {id: 'val', value: 'date', childs: 'childs'},
            cancelBtnText: 'cancel',
            ensureBtnText: 'ensure',
            triggerDisplayData: true,
            onConfirm: function(a, b){
                console.log(a, b);
                document.getElementById('onConfirm').innerText='onConfirm'+a[0]+b[0].date;
            },
            onCancel: function(a, b){
                if (a.length === 0) return;
                document.getElementById('onCancel').innerText='onCancel'+a[0]+b[0].date;
            },
            transitionEnd: function(a, b){
                console.log('tend!');
                document.getElementById('transitionEnd').innerText='transitionEnd'+a[0]+b[0].date;
            },
            onShow: function(e){
                document.getElementById('onShow').innerText='onShow';
            },
            onHide: function(e){
                document.getElementById('onHide').innerText='onHide';
            },
            onChange: function(data){
                console.log(data);
            },
            title: '选择日期',
            ensureBtnColor: '#000',
            cancelBtnColor: '#000',
            textColor: 'red',
            titleColor: '#000',
            titleBgColor: '#fff',
            bgColor: '#fff',
            maskOpacity: 0.5,
            style: {
                wrap: {
                    color: '#444'
                },
                mask: {
                    height: '50em'
                }
            }
        });

        document.getElementById('exampleshow').onclick = function(){
            window.newPicker.showPicker(['19', '1922', '192215']);
        };

        document.getElementById('exampleUpdateMobile').onclick = function(){
            window.newMobileSelect.showPicker(['周二', '10:00']);
            // window.newMobileSelect.showPicker([7, 9, 2, 20]);
        };

    </script>
</html>